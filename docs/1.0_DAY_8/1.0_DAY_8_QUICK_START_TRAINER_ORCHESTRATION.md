# Quick Start: Running the Trainer Orchestrator

**Status:** âœ… Pure RL Worker Ready | ðŸ”´ BDI Agent Deprecated  
**Date:** October 16, 2025

## Working Commands

### 1. Run Pure RL Training (Headless)

```bash
# Create config
cat > /tmp/train_config.json << 'EOF'
{
  "run_id": "frozenlake_001",
  "env_id": "FrozenLake-v2",
  "agent_id": "qlearning",
  "seed": 42,
  "max_episodes": 10,
  "max_steps_per_episode": 100,
  "policy_strategy": "train_and_save",
  "policy_path": null,
  "capture_video": false,
  "headless": true,
  "extra": {}
}
EOF

# Run worker
python -m spadeBDI_RL_refactored.worker < /tmp/train_config.json
```

**Expected Output:** JSONL telemetry streamed to stdout

### 2. Run All Tests

```bash
# All worker tests (should take <1 second)
python -m pytest spadeBDI_RL_refactored/tests/test_worker_*.py -v

# Expected: 4/4 PASSED
# - test_worker_imports_without_matplotlib âœ…
# - test_worker_dry_run âœ…
# - test_no_matplotlib_in_refactored_package âœ…
# - test_full_training_run âœ…
```

### 3. Check ejabberd Status (For Future BDI Work)

```bash
docker ps --filter name=ejabberd
# Should show: Up X minutes (healthy)
```

## What Works

âœ… **HeadlessTrainer**
- Q-learning agent
- FrozenLake-v2 environment
- Telemetry emission (JSONL)
- Policy persistence
- Episode/step tracking

âœ… **Worker Process**
- Reads config from stdin
- Emits structured telemetry
- Handles errors gracefully
- Returns exit code 0 on success

âœ… **Testing Infrastructure**
- Matplotlib-free verification
- Integration tests
- Dry-run validation
- Code quality checks

## What Doesn't Work

ðŸ”´ **SPADE-BDI Agent**
- Legacy imports broken
- Cannot instantiate BDI agent
- Module marked DEPRECATED
- Use pure RL instead

## Next Development Tasks

### Phase 1: GUI Integration (Priority)

1. **Wire TelemetryAsyncHub** into `bootstrap_default_services()`
   ```python
   # gym_gui/services/bootstrap.py
   from .trainer.streams import TelemetryAsyncHub
   
   hub = TelemetryAsyncHub()
   hub.start()
   locator.register(TelemetryAsyncHub, hub)
   ```

2. **Add TrainerClientRunner** to service locator
   ```python
   from .trainer.client import TrainerClient, TrainerClientRunner
   
   client = TrainerClient()
   runner = TrainerClientRunner(client)
   locator.register(TrainerClientRunner, runner)
   ```

3. **Create "Train Agent" Button** in main window
   - Opens training configuration dialog
   - Submits to trainer daemon
   - Launches LiveTelemetryController

4. **Test Live Telemetry Streaming**
   - Submit training run from GUI
   - Watch "Agent_{id}_Tab" appear dynamically
   - Verify step/episode updates in real-time

### Phase 2: Trainer Daemon Integration

1. Start daemon: `python -m gym_gui.services.trainer_daemon`
2. GUI connects via TrainerClient
3. Submit runs, watch progress
4. Cancel/health check functionality

### Phase 3: BDI Integration (Future, Optional)

Only if BDI reasoning is required:
- Fix legacy code imports, OR
- Rewrite using spade-bdi library directly
- See `1.0_DAY_8_BDI_AGENT_TESTING_FINDINGS.md` for options

## Telemetry Format

Worker emits JSONL (one JSON object per line):

```json
{"type":"run_started","ts":"2025-10-16T09:18:33.322+00:00","run_id":"test_001","config":{...}}
{"type":"step","ts":"2025-10-16T09:18:33.333+00:00","run_id":"test_001","episode":0,"step":0,"action":1,"reward":0.0,...}
{"type":"episode","ts":"2025-10-16T09:18:34.100+00:00","run_id":"test_001","episode":0,"reward":15.0,"steps":42,...}
{"type":"run_completed","ts":"2025-10-16T09:18:40.500+00:00","run_id":"test_001","status":"completed"}
```

## Common Issues

### "ModuleNotFoundError: No module named 'src'"
- **Cause:** Trying to use deprecated BDI agent
- **Fix:** Use pure RL worker (HeadlessTrainer)

### "matplotlib not found"
- **Cause:** Should not happen - we removed all matplotlib deps
- **Fix:** Run `pytest spadeBDI_RL_refactored/tests/test_worker_no_matplotlib.py`

### ejabberd not running
- **Cause:** Docker container stopped
- **Fix:** `cd spadeBDI_RL_refactored/infrastructure && docker-compose up -d`
- **Note:** Only needed for future BDI work, not for pure RL

## Documentation

- `1.0_DAY_7_TRAINER_ORCHESTRATION_PHASE_1.md` - Original plan
- `1.0_DAY_7_TRAINER_ORCHESTRATION_PHASE_2.md` - Artifacts & metrics
- `1.0_DAY_8_MATPLOTLIB_REMOVAL_AND_TESTING.md` - Cleanup work
- `1.0_DAY_8_BDI_AGENT_TESTING_FINDINGS.md` - BDI integration findings

## Contact Points

**Working Code:**
- `spadeBDI_RL_refactored/worker.py` - Entry point
- `spadeBDI_RL_refactored/core/runtime.py` - HeadlessTrainer
- `spadeBDI_RL_refactored/algorithms/qlearning.py` - Q-learning impl
- `gym_gui/services/trainer/` - Daemon & client (ready for integration)

**Deprecated Code:**
- `spadeBDI_RL_refactored/core/agent.py` - BDI agent (broken imports)
- `spadeBDI_RL/` - Legacy codebase (not properly packaged)

---

**Quick Test:** `python -m pytest spadeBDI_RL_refactored/tests/ -v`  
**Expected:** 4 passed in <1s âœ…
