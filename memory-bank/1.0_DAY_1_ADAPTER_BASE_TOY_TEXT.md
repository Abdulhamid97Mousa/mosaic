# Day 1 Plan – Adapter Base & Toy-Text Environments

## WHY this milestone matters
- Establish a repeatable adapter contract so every Gymnasium environment plugs into the Qt GUI with minimal glue.
- Deliver the first playable experiences (FrozenLake, CliffWalking, Taxi) to validate configuration, rendering, and control-mode scaffolding.
- Capture Gymnasium API nuances early, preventing ad-hoc code in later phases and keeping the learning journal actionable.

## WHAT we will ship
- `gym_gui/core/adapters/base.py`: abstract `EnvironmentAdapter` defining lifecycle hooks (`load`, `reset`, `step`, `render`, `close`) and typed accessors for spaces, metadata, and orchestrator callbacks.
- `gym_gui/core/adapters/toy_text.py`: concrete adapters for FrozenLake, CliffWalking, Taxi implementing deterministic/seeding controls and grid render helpers.
- `gym_gui/runtime/data/toy_text/`: persisted assets (e.g., cached grid layouts) generated at runtime.
- Tests or smoke scripts that exercise the adapter API without Qt GUI, ensuring adapters can be invoked headlessly during development.

## HOW we will design it
1. **Interface-first approach**
   - Define `AdapterContext` dataclass holding settings, logger, and references to orchestrator callbacks.
   - Encapsulate `gymnasium.make` inside `EnvironmentAdapter.load()` with registry key and optional kwargs.
   - Provide mixins/utilities for seeding, observation casting, reward shaping where appropriate.
2. **Observation packaging**
   - Standardise `AdapterStep` namedtuple/dataclass with fields: `observation`, `reward`, `terminated`, `truncated`, `info`, and `render_payload`.
   - For toy-text, convert Gymnasium ASCII render output into structured grid payload for Qt widgets (`List[List[str]]`).
3. **Render strategy alignment**
   - Use `RenderMode.GRID` by default while still supporting Gymnasium's `"ansi"` output for CLI fallback.
   - Store reusable glyph maps in `gym_gui/runtime/data/toy_text` at runtime, keeping the repository clean of generated assets.
4. **Error handling & logging**
   - Channel adapter diagnostics through `logging_config.logger.configure_logging`, tagging log records with adapter name for filtering.
   - Raise domain-specific exceptions (`AdapterNotReadyError`, `UnsupportedModeError`) to simplify controller logic.

## References from Gymnasium docs
- [Environment API](https://gymnasium.farama.org/api/env/) – authoritative contract for `reset`, `step`, `render`, `close`, `seed` semantics.
- [Registry API](https://gymnasium.farama.org/api/registry/) – source of canonical IDs (`FrozenLake-v1`, etc.) and configuration overrides.
- [Wrappers API](https://gymnasium.farama.org/api/wrappers/) – consider `TimeLimit`, `OrderEnforcing`, and custom wrappers for telemetry.
- [Utils API](https://gymnasium.farama.org/api/utils/) – RNG utilities for reproducible experiments (`gymnasium.utils.seeding`).
- [Functional API](https://gymnasium.farama.org/api/functional/) – outlines stateless variants; helpful if adopting pure functions for agent training later.

## Folder structure after implementation
```
gym_gui/
  core/
    adapters/
      __init__.py
      base.py
      toy_text.py
  runtime/
    data/
      toy_text/
        README.md          # Explains generated layouts / cache policy
```

## Acceptance checklist
- [x] Base adapter exposes lifecycle methods with type hints and docstrings referencing Gymnasium API.
- [x] Toy-text adapters return grid payload compatible with planned Qt widgets.
- [x] Default control modes from `core.enums` map cleanly to adapter capabilities (e.g., hybrid turn-based for Toy Text).
- [x] Unit smoke script runs outside Qt (`python -m gym_gui.core.adapters.toy_text_demo`) and produces deterministic results when seeded.
- [ ] Docs updated (`README`, learning journal) with adapter architecture and lessons learned.

## Risks & mitigations
- **Box2D extras currently blocked**: `gymnasium[box2d]` requires the native `swig` binary. Track this in the backlog; install via system package manager before Phase 3 (Box2D environments).
- **Rendering mismatch**: If Grid render conflicts with Qt layout, maintain ANSI fallback and build small CLI viewer for debugging.
- **Runtime cache growth**: Add pruning hooks or CLI command to clear `runtime/data/toy_text` between sessions.

## Next steps after Day 1
1. Extend adapters to cover Classic Control (CartPole) to validate continuous observation handling.
2. Expand the adapter registry to register Classic Control and Box2D implementations once available.
3. Use the new CLI orchestrator (`python -m gym_gui.controllers.cli`) for rapid human-in-the-loop smoke tests while the Qt shell is under construction.

## Phase 2 preview – Qt shell & asset integration
- **Environment picker:** Build a minimal main window with a combo box of `GameId` values backed by the adapter factory, wiring launch buttons to instantiate adapters on demand.
- **Log console:** Embed a Qt text widget streaming from the logging subsystem so the existing DEBUG traces mirror what we see in the CLI.
- **Sprite usage:** Load Gymnasium-provided assets (for example, `gymnasium/envs/toy_text/img/elf_down.png`) via `importlib.resources` at runtime so the GUI can opt into richer tiles without committing third-party art to the repo.
- **Keyboard bridge:** Reuse the CLI orchestration commands to power a Qt-friendly action dispatcher, ensuring feature parity between headless and GUI flows.
