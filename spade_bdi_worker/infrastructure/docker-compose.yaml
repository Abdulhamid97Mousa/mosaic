version: "3.9"

services:
  ejabberd:
    image: ejabberd/ecs:latest
    container_name: ejabberd
    restart: unless-stopped

    environment:
      - EJABBERD_MACRO_HOST=localhost
      - REGISTER_ADMIN_PASSWORD=admin
      - CTL_ON_CREATE=register agent localhost secret
      - ERLANG_NODE_ARG=ejabberd@localhost

    ports:
      - "5222:5222"
      - "5280:5280"
      - "5443:5443"

    volumes:
      - ejabberd-db:/home/ejabberd/database
      - ejabberd-logs:/home/ejabberd/logs

    healthcheck:
      test: ["CMD", "ejabberdctl", "status"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  ejabberd-db:
  ejabberd-logs:
